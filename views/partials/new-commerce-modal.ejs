<!-- Modal -->
<div class="modal fade" id="new-commerce-modal" role="dialog" aria-labelledby="new-commerceLabel">
    <div class="modal-dialog" role="document">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title" id="new-commerceLabel">Nuevo Comercio</h4>
        </div>
        <div class="modal-body">            
            <form id="new-commerce-form" action="create" method="post" data-toggle="validator" novalidate>
                <input type="hidden" class="new-id" name="id">
                
                <label for="new-code">Codigo</label>
                <input class="form-control new-code" id="new-code" type="text" name="code" maxlength="12" required data-error="Debe ingresar cÃ³digo para el comercio">
                <div class="help-block with-errors"></div>
                
                <label for="new-name">Nombre</label>
                <input class="form-control new-name" id="new-name" type="text" name="name" required data-error="Debe ingresar un nombre">
                <div class="help-block with-errors"></div>
                
                <label for="new-description">Descripcion</label>
                <input class="form-control new-description" id="new-description" type="text" name="description">
                <div class="help-block with-errors"></div>
                
                <label for="new-latitude">Latitud</label>
                <input class="form-control new-latitude" id="new-latitude" type="number" name="latitude" max="90" min="-90" required data-error="Debe ingresar valores dentro del rango -90 a 90 ">
                <div class="help-block with-errors"></div>
                
                <label for="new-longitude">Longitud</label>
                <input class="form-control new-longitude" id="new-longitude" type="number" name="longitude" max="180" min="-180" required data-error="Debe ingresar valores dentro del rango -180 a 180 ">
                <div class="help-block with-errors"></div>
                
                <br>
                
                <button type="submit" class="btn btn-primary">Agregar</button>
            </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
        </div>
      </div>
    </div>
</div>

<script>
$(document).ready(function() {
    $('#new-commerce-modal')
        .on('success', function(e) {
            // Save the form data via an Ajax request
            e.preventDefault();
            
            console.log($form.serialize());
            
            var $form = $(e.target),
                id    = $form.find('[name="id"]').val(); 
        
            // The url and method might be different in your application
            $.ajax({
                url: 'http://localhost:2728/commerce/post',
                method: 'PUT',
                data: $form.serialize()
            }).success(function(response) {
                console.log(response);
                // Get the cells
                var $button = $('button[data-id="' + response.id + '"]'),
                    $tr     = $button.closest('tr'),
                    $cells  = $tr.find('th');

                // Update the cell data
                $cells
                    .eq(1).html(response.id).end()
                    .eq(2).html(response.code).end()
                    .eq(3).html(response.name).end()
                    .eq(4).html(response.description).end()
                    .eq(5).html(response.latitude).end()
                    .eq(6).html(response.longitude).end();

                // Hide the dialog
                $form.parents('.bootbox').modal('hide');

                // You can inform the user that the data is updated successfully
                // by highlighting the row or showing a message box
                bootbox.alert('Commercio Actualizado');
            });
        });

    $('.editButton').on('click', function() {
        // Get the record's ID via attribute
        var id = $(this).attr('data-id');
                
        $.ajax({
            url: 'http://localhost:2728/commerce/' + id,
            method: 'GET'
        }).success(function(response) {
            // Populate the form fields with the data returned from server
            $('#edit-commerce-modal')
                .find('[name="id"]').val(response.id).end()
                .find('[name="code"]').val(response.code).end()
                .find('[name="name"]').val(response.name).end()
                .find('[name="description"]').val(response.description).end()
                .find('[name="latitude"]').val(response.latitude).end()
                .find('[name="longitude"]').val(response.longitude).end();
        });
    });
});
</script>